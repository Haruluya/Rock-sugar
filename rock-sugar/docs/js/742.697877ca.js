"use strict";(self["webpackChunkrock_sugar"]=self["webpackChunkrock_sugar"]||[]).push([[742],{5742:function(e,t,a){a.r(t),a.d(t,{default:function(){return d}});var n=a(3396);function r(e,t,a,r,o,i){const s=(0,n.up)("webgl_basic_render_panel");return(0,n.wg)(),(0,n.j4)(s,{prop_des_data:o.desData,prop_ui_setter:o.uiSetter,prop_vertex_shader:o.vertexShaderSource,prop_fragment_shader:o.fragmentShaderSource,prop_section_params:o.sectionParams,ref:"page",onInit:i.Init,onRender:i.Render,onProp_ui_setter:o.uiSetter},null,8,["prop_des_data","prop_ui_setter","prop_vertex_shader","prop_fragment_shader","prop_section_params","onInit","onRender","onProp_ui_setter"])}var o="\nattribute vec4 a_position;\nattribute vec3 a_normal;\nattribute vec3 a_tangent;\nattribute vec2 a_texcoord;\nattribute vec4 a_color;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_world;\nuniform vec3 u_viewWorldPosition;\n\nvarying vec3 v_normal;\nvarying vec3 v_tangent;\nvarying vec3 v_surfaceToView;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\n\nvoid main() {\n  vec4 worldPosition = u_world * a_position;\n  gl_Position = u_projection * u_view * worldPosition;\n  v_surfaceToView = u_viewWorldPosition - worldPosition.xyz;\n  mat3 normalMat = mat3(u_world);\n  v_normal = normalize(normalMat * a_normal);\n  v_tangent = normalize(normalMat * a_tangent);\n\n  v_texcoord = a_texcoord;\n  v_color = a_color;\n}\n",i="\nprecision highp float;\n\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\n\nuniform sampler2D diffuseMap;\n\n\nvoid main () {\n\n  vec4 diffuseMapColor = texture2D(diffuseMap, v_texcoord);\n  vec3 effectiveDiffuse =  diffuseMapColor.rgb * v_color.rgb;\n\n  gl_FragColor = vec4(\n      effectiveDiffuse,\n      1);\n}\n\n",s=a(311);const c={category:"Experiment",name:"TextureEX",buttonContent:"查看源码",title:"纹理实验",content:"TextureEX."};var l={name:"TextureEX",data(){return{gl:null,canvas:null,program:null,vertexShaderSource:o,fragmentShaderSource:i,desData:c,perspective:{aspect:0,fieldOfViewRadians:HNWUEngine.degToRad(60),zNear:1,zFar:1e4},transform:{translation:[0,0,0],rotation:[HNWUEngine.degToRad(0),HNWUEngine.degToRad(0),HNWUEngine.degToRad(0)],scale:[1,1,1]},camera:{target:[0,0,0],position:[0,0,1],up:[0,1,0]},sectionParams:{lightDirection:[-1,3,5]},page:null,uiSetter:[],objectData:null,objComponentsInfo:null,objOffset:null}},computed:{defaultMaterial(){return{diffuse:[1,1,1],diffuseMap:s.Z.create1PixelTexture(this.gl,[255,255,255,0]),normalMap:s.Z.create1PixelTexture(this.gl,[255,255,255,0]),ambient:[0,0,0],specular:[0,0,0],specularMap:s.Z.create1PixelTexture(this.gl,[255,255,255,255]),shininess:400,opacity:1}}},mounted(){this.getObjectData(),setTimeout((()=>{this.$refs.page.Render()}),1e3)},methods:{Init(){if(this.page=this.$refs.page,this.gl=this.page.getGL(),!this.objectData)return;this.page.addProgram("obj",o,i),this.perspective.aspect=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight,this.$refs.page.set3DViewer(this.perspective,this.camera,this.transform);const e=this.objectData.obj;this.objOffset=this.page.setObjectToSceenCenter(e.geometries),this.objComponentsInfo=e.geometries.map((({material:e,data:t,object:a})=>{const n=a+e;return this.page.addComponent("obj",n),t.texcoord&&t.normal?(t.tangent=s.Z.generateTangents(t.position,t.texcoord),this.page.addBuffer("tangent",t.tangent,n)):this.page.addBuffer("tangent",{value:[1,0,0]},n),t.texcoord||(t.texcoord={value:[0,0]}),t.normal||(t.normal={value:[0,0,1]}),t.color?t.position.length===t.color.length&&(t.color={numComponents:3,data:t.color},this.page.addBuffer("color",t.color,n)):this.page.addBuffer("color",{value:[1,1,1,1]},n),this.page.addBuffer("position",{data:t.position},n),this.page.addBuffer("texcoord",{numComponents:2,data:t.texcoord},n),this.page.addBuffer("normal",{data:t.normal},n),console.log(this.objectData.materials[e],"material"),{name:n,component:this.page.getComponents()[n],material:{...this.defaultMaterial,...this.objectData.materials[e]}}}))},Render(){if(!this.objectData)return;const e=this.gl;e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.enable(e.MULTISAMPLE),e.clearColor(255,255,0,1);let t=HNWUEngine.perspective(this.perspective.fieldOfViewRadians,this.perspective.aspect,this.perspective.zNear,this.perspective.zFar),a=HNWUEngine.lookAt(this.camera.position,this.camera.target,this.camera.up),n=HNWUEngine.inverse(a),r=HNWUEngine.getTransformMatrix(HNWUEngine.yRotation(0),this.transform);r=HNWUEngine.translate3d(r,...this.objOffset),this.objComponentsInfo.forEach((({name:e,component:a,material:o})=>{this.page.useProgram(a.program);const i={u_world:r,u_view:n,u_lightDirection:HNWUEngine.normalize(this.sectionParams.lightDirection),u_projection:t,u_viewWorldPosition:this.camera.position},s=Object.assign(i,o);Object.entries(s).forEach((([t,a])=>{this.page.addUniform(t,a,e)})),this.page.setSetters(e),this.page.drawComponent(e)}))},async getObjectData(){let e="./models/textureEx/textureEx.obj";const t=await fetch(e),a=await t.text(),n=s.Z.objectParse(a),r=new URL(e,window.location.href),o=await Promise.all(n.materialLibs.map((async e=>{const t=new URL(e,r).href,a=await fetch(t);return await a.text()}))),i=s.Z.parseMTL(o.join("\n")),c={defaultWhite:s.Z.create1PixelTexture(this.gl,[255,255,255,255])};for(const l of Object.values(i))Object.entries(l).filter((([e])=>e.endsWith("Map"))).forEach((([e,t])=>{let a=c[t];if(!a){const e=new URL(t,r).href;a=s.Z.createTexture(this.gl,e),c[t]=a}l[e]=a}));this.objectData={obj:n,materials:i},this.$refs.page.Init()}}},p=a(89);const u=(0,p.Z)(l,[["render",r]]);var d=u}}]);
//# sourceMappingURL=742.697877ca.js.map