"use strict";(self["webpackChunkrock_sugar"]=self["webpackChunkrock_sugar"]||[]).push([[834],{5834:function(e,t,n){n.r(t),n.d(t,{default:function(){return g}});var a=n(3396);const o=e=>((0,a.dD)("data-v-77810a46"),e=e(),(0,a.Cn)(),e),l=o((()=>(0,a._)("div",{class:"webglContainer"},[(0,a._)("div",{class:"canvesContainer"},[(0,a._)("canvas",{id:"canvas"})])],-1))),r={class:"desContainer"},i={class:"des"},s=o((()=>(0,a._)("div",{class:"title"},[(0,a._)("span",{id:"category"},"webgl"),(0,a._)("span",{id:"name"},"ObjResolver")],-1))),u={class:"codeLink"},c=o((()=>(0,a._)("div",{class:"conclusion"},[(0,a._)("span",{class:"title"},[(0,a._)("span",{id:"conTitle"},"模型渲染")]),(0,a._)("span",{class:"content"},"I can't build a model of the future, let alone render it.")],-1))),_={class:"menu"};function m(e,t,n,o,m,f){const d=(0,a.up)("nano_button"),h=(0,a.up)("nano_items_menu");return(0,a.wg)(),(0,a.iD)("body",null,[l,(0,a._)("div",r,[(0,a._)("div",i,[s,(0,a._)("div",u,[(0,a.Wm)(d,{onHandleClick:e.handleClick},null,8,["onHandleClick"])])]),c,(0,a._)("div",_,[(0,a.Wm)(h)])])])}n(7658);var f={name:"ObjResolver",mounted(){this.Render()},methods:{Render(){function e(e){const t=[[0,0,0]],n=[[0,0]],a=[[0,0,0]],o=[[0,0,0]],l=[t,n,a,o];let r=[[],[],[],[]];const i=[],s=[];let u,c=["default"],_="default",m="default";const f=()=>{};function d(){u&&u.data.position.length&&(u=void 0)}function h(){if(!u){const e=[],t=[],n=[],a=[];r=[e,t,n,a],u={object:m,groups:c,material:_,data:{position:e,texcoord:t,normal:n,color:a}},s.push(u)}}function g(e){const t=e.split("/");t.forEach(((e,t)=>{if(!e)return;const n=parseInt(e),a=n+(n>=0?0:l[t].length);r[t].push(...l[t][a]),0===t&&o.length>1&&u.data.color.push(...o[a])}))}const v={v(e){e.length>3?(t.push(e.slice(0,3).map(parseFloat)),o.push(e.slice(3).map(parseFloat))):t.push(e.map(parseFloat))},vn(e){a.push(e.map(parseFloat))},vt(e){n.push(e.map(parseFloat))},f(e){h();const t=e.length-2;for(let n=0;n<t;++n)g(e[0]),g(e[n+1]),g(e[n+2])},s:f,mtllib(e,t){i.push(t)},usemtl(e,t){_=t,d()},g(e){c=e,d()},o(e,t){m=t,d()}},p=/(\w*)(?: )*(.*)/,b=e.split("\n");for(let w=0;w<b.length;++w){const e=b[w].trim();if(""===e||e.startsWith("#"))continue;const t=p.exec(e);if(!t)continue;const[,n,a]=t,o=e.split(/\s+/).slice(1),l=v[n];l?l(o,a):console.warn("unhandled keyword:",n)}for(const w of s)w.data=Object.fromEntries(Object.entries(w.data).filter((([,e])=>e.length>0)));return{geometries:s,materialLibs:i}}async function t(){const t=document.querySelector("#canvas"),n=t.getContext("webgl");if(!n)return;const a="\n    attribute vec4 a_position;\n    attribute vec3 a_normal;\n    attribute vec4 a_color;\n\n    uniform mat4 u_projection;\n    uniform mat4 u_view;\n    uniform mat4 u_world;\n\n    varying vec3 v_normal;\n    varying vec4 v_color;\n\n    void main() {\n        gl_Position = u_projection * u_view * u_world * a_position;\n        v_normal = mat3(u_world) * a_normal;\n        v_color = a_color;\n    }\n    ",o="\n    precision mediump float;\n\n    varying vec3 v_normal;\n    varying vec4 v_color;\n\n    uniform vec4 u_diffuse;\n    uniform vec3 u_lightDirection;\n\n    void main () {\n        vec3 normal = normalize(v_normal);\n        float fakeLight = dot(u_lightDirection, normal) * .5 + .5;\n        vec4 diffuse = u_diffuse * v_color;\n        gl_FragColor = vec4(diffuse.rgb * fakeLight, diffuse.a);\n    }\n    ",l=haruluya_webgl_utils.createProgramInfo(n,[a,o]),r=await fetch("https://webglfundamentals.org/webgl/resources/models/book-vertex-chameleon-study/book.obj"),i=await r.text(),s=e(i),u=s.geometries.map((({data:e})=>{e.color?e.position.length===e.color.length&&(e.color={numComponents:3,data:e.color}):e.color={value:[1,1,1,1]};const t=haruluya_webgl_utils.createBufferInfoFromArrays(n,e);return{material:{u_diffuse:[1,1,1,1]},bufferInfo:t}}));function c(e){const t=e.slice(0,3),n=e.slice(0,3);for(let a=3;a<e.length;a+=3)for(let o=0;o<3;++o){const l=e[a+o];t[o]=Math.min(l,t[o]),n[o]=Math.max(l,n[o])}return{min:t,max:n}}function _(e){return e.reduce((({min:e,max:t},{data:n})=>{const a=c(n.position);return{min:e.map(((e,t)=>Math.min(a.min[t],e))),max:t.map(((e,t)=>Math.max(a.max[t],e)))}}),{min:Array(3).fill(Number.POSITIVE_INFINITY),max:Array(3).fill(Number.NEGATIVE_INFINITY)})}const m=_(s.geometries),f=haruluya_webgl_utils.subtractVectors(m.max,m.min),d=haruluya_webgl_utils.scaleVector(haruluya_webgl_utils.addVectors(m.min,haruluya_webgl_utils.scaleVector(f,.5)),-1),h=[0,0,0],g=1.2*haruluya_webgl_utils.length(f),v=haruluya_webgl_utils.addVectors(h,[0,0,g]),p=g/100,b=3*g;function w(e){return e*Math.PI/180}function y(e){e*=.001,haruluya_webgl_utils.resizeCanvasToDisplaySize(n.canvas),n.viewport(0,0,n.canvas.width,n.canvas.height),n.enable(n.DEPTH_TEST);const t=w(60),a=n.canvas.clientWidth/n.canvas.clientHeight,o=haruluya_webgl_utils.perspective(t,a,p,b),r=[0,1,0],i=haruluya_webgl_utils.lookAt(v,h,r),s=haruluya_webgl_utils.inverse(i),c={u_lightDirection:haruluya_webgl_utils.normalize([-1,3,5]),u_view:s,u_projection:o};n.useProgram(l.program),haruluya_webgl_utils.setUniforms(l,c);let _=haruluya_webgl_utils.yRotation(e);_=haruluya_webgl_utils.translate3d(_,...d);for(const{bufferInfo:m,material:f}of u)haruluya_webgl_utils.setBuffersAndAttributes(n,l,m),haruluya_webgl_utils.setUniforms(l,{u_world:_,u_diffuse:f.u_diffuse}),haruluya_webgl_utils.drawBufferInfo(n,m);requestAnimationFrame(y)}requestAnimationFrame(y)}t()}}},d=n(89);const h=(0,d.Z)(f,[["render",m],["__scopeId","data-v-77810a46"]]);var g=h}}]);
//# sourceMappingURL=834.8134958b.js.map