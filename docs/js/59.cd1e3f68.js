"use strict";(self["webpackChunkrock_sugar"]=self["webpackChunkrock_sugar"]||[]).push([[59],{3059:function(i,t,e){e.r(t),e.d(t,{default:function(){return f}});var n=e(3396);function o(i,t,e,o,a,r){const s=(0,n.up)("nano_webgl_demo_panel");return(0,n.wg)(),(0,n.j4)(s,{prop_des_data:a.desData,prop_ui_setter:a.uiSetter,prop_vertex_shader:a.vertexShaderSource,prop_fragment_shader:a.fragmentShaderSource,prop_section_params:a.sectionParams,ref:"page",onInit:r.Init,onRender:r.Render,onProp_ui_setter:a.uiSetter},null,8,["prop_des_data","prop_ui_setter","prop_vertex_shader","prop_fragment_shader","prop_section_params","onInit","onRender","onProp_ui_setter"])}var a="\nattribute vec4 a_position;\nattribute vec3 a_normal;\nattribute vec4 a_color;\nuniform vec3 u_lightWorldPosition;\nuniform vec3 u_viewWorldPosition;\nuniform mat4 u_world;\nuniform mat4 u_worldViewProjection;\nuniform mat4 u_worldInverseTranspose;\nvarying vec3 v_normal;\nvarying vec3 v_surfaceToLight;\nvarying vec3 v_surfaceToView;\nvarying vec4 v_color;\nvoid main() {\n    gl_Position = u_worldViewProjection * a_position;\n    v_normal = mat3(u_worldInverseTranspose) * a_normal;\n    vec3 surfaceWorldPosition = (u_world * a_position).xyz;\n    v_surfaceToLight = u_lightWorldPosition - surfaceWorldPosition;\n    v_surfaceToView = u_viewWorldPosition - surfaceWorldPosition;\n    v_color = a_color;\n}\n",r="\nprecision mediump float;\nvarying vec3 v_normal;\nvarying vec3 v_surfaceToLight;\nvarying vec3 v_surfaceToView;\n\nvarying vec4 v_color;\nuniform float u_shininess;\nuniform vec3 u_lightDirection;\nuniform float u_innerLimit;          // in dot space\nuniform float u_outerLimit;          // in dot space\nvoid main() {\n    vec3 normal = normalize(v_normal);\n    vec3 surfaceToLightDirection = normalize(v_surfaceToLight);\n    vec3 surfaceToViewDirection = normalize(v_surfaceToView);\n    vec3 halfVector = normalize(surfaceToLightDirection + surfaceToViewDirection);\n    float dotFromDirection = dot(surfaceToLightDirection,\n                                -u_lightDirection);\n    float inLight = smoothstep(u_outerLimit, u_innerLimit, dotFromDirection);\n    float light = inLight * dot(normal, surfaceToLightDirection);\n    float specular = inLight * pow(dot(normal, halfVector), u_shininess);\n\n    gl_FragColor = v_color;\n    gl_FragColor.rgb *= light;\n    gl_FragColor.rgb += specular;\n}\n\n",s=(e(8675),e(3408),e(4590),{position:new Float32Array([200,50,0,0,50,0,0,150,0,0,150,0,200,150,0,200,50,0,200,50,100,0,50,100,0,50,0,0,50,0,200,50,0,200,50,100,200,50,0,200,150,0,200,150,100,200,150,100,200,50,100,200,50,0,0,50,0,0,50,100,0,150,100,0,150,100,0,150,0,0,50,0,0,150,0,0,150,100,200,150,100,200,150,100,200,150,0,0,150,0,200,50,100,200,150,100,0,150,100,0,150,100,0,50,100,200,50,100]),color:new Uint8Array([0,59,252,0,80,252,0,218,252,0,218,252,0,80,252,0,59,252,252,0,0,150,0,0,0,0,0,0,0,0,150,0,0,252,0,0,252,227,103,150,227,103,0,227,103,0,227,103,150,227,103,252,227,103,252,227,103,150,227,103,0,227,103,0,227,103,150,227,103,252,227,103,252,0,0,150,0,0,0,0,0,0,0,0,150,0,0,252,0,0,0,59,252,0,80,252,0,218,252,0,218,252,0,80,252,0,59,252]),normal:[0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1,0,0,-1]}),l=e(720);const c={category:"Webgl",name:"SpotLight",buttonContent:"查看源码",title:"聚光灯",content:"potlight will never be on me."},g=s.position,h=s.color,m=s.normal;var d={name:"SpotLight",data(){return{gl:null,canvas:null,program:null,vertexShaderSource:a,fragmentShaderSource:r,desData:c,perspective:{aspect:0,fieldOfViewRadians:HNWUEngine.degToRad(60),zNear:1,zFar:2e3},transform:{translation:[0,0,0],rotation:[HNWUEngine.degToRad(190),HNWUEngine.degToRad(200),HNWUEngine.degToRad(360)],scale:[1,.8,1]},camera:{target:[0,35,0],position:[100,150,200],up:[0,1,0]},sectionParams:{shininess:10,lightRotation:{x:0,y:0},lightDirection:[0,0,1],lightPosition:{x:40,y:60,z:120},innerLimit:21,outerLimit:35},uiSetter:[]}},methods:{Init(){this.gl=this.$refs.page.getGL(),this.canvas=this.$refs.page.getCanvas(),this.program=this.$refs.page.getProgram(),this.perspective.aspect=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight,this.setPosition();const i=[this.sectionParams.lightPosition.x,this.sectionParams.lightPosition.y,this.sectionParams.lightPosition.z];var t=HNWUEngine.lookAt(i,this.camera.target,this.camera.up);t=HNWUEngine.multiply3d(HNWUEngine.xRotation(this.sectionParams.lightRotation.x),t),t=HNWUEngine.multiply3d(HNWUEngine.yRotation(this.sectionParams.lightRotation.y),t),this.sectionParams.lightDirection=[-t[8],-t[9],-t[10]],this.$refs.page.setTransform(this.transform),this.$refs.page.addBuffer("position",{data:g}),this.$refs.page.addBuffer("color",{data:h}),this.$refs.page.addBuffer("normal",{data:m})},Render(){const i=this.gl,t=[this.sectionParams.lightPosition.x,this.sectionParams.lightPosition.y,this.sectionParams.lightPosition.z];i.enable(i.CULL_FACE),i.enable(i.DEPTH_TEST);let e=HNWUEngine.lookAt(this.camera.position,this.camera.target,this.camera.up),n=HNWUEngine.inverse(e),o=HNWUEngine.perspective(this.perspective.fieldOfViewRadians,this.perspective.aspect,this.perspective.zNear,this.perspective.zFar),a=HNWUEngine.multiply3d(o,n),r=HNWUEngine.getTransformMatrix(HNWUEngine.yRotation(0),this.transform),s=HNWUEngine.multiply3d(a,r),l=HNWUEngine.inverse(r),c=HNWUEngine.transpose(l);this.$refs.page.addUniform("u_worldViewProjection",s),this.$refs.page.addUniform("u_worldInverseTranspose",c),this.$refs.page.addUniform("u_world",r),this.$refs.page.addUniform("u_lightWorldPosition",t),this.$refs.page.addUniform("u_viewWorldPosition",this.camera.position),this.$refs.page.addUniform("u_shininess",this.sectionParams.shininess),this.$refs.page.addUniform("u_lightDirection",this.sectionParams.lightDirection),this.$refs.page.addUniform("u_innerLimit",Math.cos(HNWUEngine.degToRad(this.sectionParams.innerLimit))),this.$refs.page.addUniform("u_outerLimit",Math.cos(HNWUEngine.degToRad(this.sectionParams.outerLimit)));var g=HNWUEngine.lookAt(t,this.camera.target,this.camera.up);g=HNWUEngine.multiply3d(HNWUEngine.xRotation(this.sectionParams.lightRotation.x),g),g=HNWUEngine.multiply3d(HNWUEngine.yRotation(this.sectionParams.lightRotation.y),g),this.sectionParams.lightDirection=[-g[8],-g[9],-g[10]],this.$refs.page.glDraw({mode:i.TRIANGLES,first:0,count:96})},setPosition(){let i=HNWUEngine.xRotation(Math.PI);i=HNWUEngine.translate3d(i,-50,-75,-15);for(let t=0;t<g.length;t+=3){let e=HNWUEngine.transformPoint(i,[g[t+0],g[t+1],g[t+2],1]);g[t+0]=e[0],g[t+1]=e[1],g[t+2]=e[2]}}},mounted(){this.uiSetter=[{type:"slider",id:"shininess",value:this.sectionParams.shininess,min:0,max:20,callback:l.Z.globalUiCallbacks.updateValue(this.sectionParams,this.$refs.page.Render,"shininess")},{type:"slider",id:"innerLimit",value:this.sectionParams.innerLimit,min:0,max:50,callback:l.Z.globalUiCallbacks.updateValue(this.sectionParams,this.$refs.page.Render,"innerLimit")},{type:"slider",id:"outerLimit",value:this.sectionParams.outerLimit,min:0,max:100,callback:l.Z.globalUiCallbacks.updateValue(this.sectionParams,this.$refs.page.Render,"outerLimit")},{type:"slider-vector",id:"lightRotation",value:this.sectionParams.lightRotation,min:{x:-100,y:-100},max:{x:100,y:100},callback:l.Z.globalUiCallbacks.updateVector3(this.sectionParams,this.$refs.page.Render,"lightRotation")},{type:"slider-vector",id:"lightPosition",value:this.sectionParams.lightPosition,min:{x:-100,y:-100,z:-100},max:{x:100,y:100,z:100},callback:l.Z.globalUiCallbacks.updateVector3(this.sectionParams,this.$refs.page.Render,"lightPosition")}]}},u=e(89);const p=(0,u.Z)(d,[["render",o],["__scopeId","data-v-5255c19a"]]);var f=p}}]);
//# sourceMappingURL=59.cd1e3f68.js.map