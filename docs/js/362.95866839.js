"use strict";(self["webpackChunkrock_sugar"]=self["webpackChunkrock_sugar"]||[]).push([[362],{4362:function(e,t,a){a.r(t),a.d(t,{default:function(){return g}});var i=a(3396);function n(e,t,a,n,o,r){const s=(0,i.up)("webgl_basic_render_panel");return(0,i.wg)(),(0,i.j4)(s,{prop_des_data:o.desData,prop_ui_setter:r.uiSetter,prop_vertex_shader:o.vertexShaderSource,prop_fragment_shader:o.fragmentShaderSource,prop_section_params:o.sectionParams,ref:"page",onInit:r.Init,onRender:r.Render,onProp_ui_setter:r.uiSetter},null,8,["prop_des_data","prop_ui_setter","prop_vertex_shader","prop_fragment_shader","prop_section_params","onInit","onRender","onProp_ui_setter"])}var o="\nattribute vec4 a_position;\nattribute vec3 a_normal;\nattribute vec3 a_tangent;\nattribute vec2 a_texcoord;\nattribute vec4 a_color;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_world;\nuniform vec3 u_viewWorldPosition;\n\nvarying vec3 v_normal;\nvarying vec3 v_tangent;\nvarying vec3 v_surfaceToView;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\n\nvoid main() {\n  vec4 worldPosition = u_world * a_position;\n  gl_Position = u_projection * u_view * worldPosition;\n  v_surfaceToView = u_viewWorldPosition - worldPosition.xyz;\n  mat3 normalMat = mat3(u_world);\n  v_normal = normalize(normalMat * a_normal);\n  v_tangent = normalize(normalMat * a_tangent);\n\n  v_texcoord = a_texcoord;\n  v_color = a_color;\n}\n",r="\nprecision highp float;\n\nvarying vec3 v_normal;\nvarying vec3 v_tangent;\nvarying vec3 v_surfaceToView;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\n\nuniform vec3 diffuse;\nuniform sampler2D diffuseMap;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform sampler2D specularMap;\nuniform float shininess;\nuniform sampler2D normalMap;\nuniform float opacity;\nuniform vec3 u_lightDirection;\nuniform vec3 u_lightColor;\n\nuniform vec3 u_ambientLight;\n\nvoid main () {\n  vec3 normal = normalize(v_normal) * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n  vec3 tangent = normalize(v_tangent) * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n  vec3 bitangent = normalize(cross(normal, tangent));\n\n  mat3 tbn = mat3(tangent, bitangent, normal);\n  normal = texture2D(normalMap, v_texcoord).rgb * 2. - 1.;\n  normal = normalize(tbn * normal);\n\n  vec3 surfaceToViewDirection = normalize(v_surfaceToView);\n  vec3 halfVector = normalize(u_lightDirection + surfaceToViewDirection);\n\n  float fakeLight = dot(u_lightDirection, normal) * .5 + .5;\n  float specularLight = clamp(dot(normal, halfVector), 0.0, 1.0);\n  vec4 specularMapColor = texture2D(specularMap, v_texcoord);\n  vec3 effectiveSpecular = specular * specularMapColor.rgb;\n\n  vec4 diffuseMapColor = texture2D(diffuseMap, v_texcoord);\n  vec3 effectiveDiffuse = diffuse* v_color.rgb;\n  float effectiveOpacity = opacity * v_color.a;\n\n  gl_FragColor = vec4(\n      emissive +\n      ambient * u_ambientLight +\n      effectiveDiffuse * fakeLight * u_lightColor +\n      effectiveSpecular * pow(specularLight, shininess),\n      effectiveOpacity);\n}\n\n",s=a(311),l=a(2812);const c={category:"Experiment",name:"LightModel",buttonContent:"查看源码",title:"光照模型实例",content:"LightModel."};var u={name:"LightModel",data(){return{gl:null,canvas:null,program:null,vertexShaderSource:o,fragmentShaderSource:r,desData:c,perspective:{aspect:0,fieldOfViewRadians:HNWUEngine.degToRad(60),zNear:1,zFar:1e3},transform:{translation:[0,0,0],rotation:[HNWUEngine.degToRad(80),HNWUEngine.degToRad(130),HNWUEngine.degToRad(0)],scale:[1.8,1.8,1.8]},camera:{target:[0,0,0],position:[0,0,1],up:[0,1,0]},sectionParams:{lightDirection:{x:-1,y:3,z:5},lightColor:{x:255,y:255,z:255},diffuse:{x:203,y:143,z:24},ambient:{x:0,y:0,z:0},specular:{x:0,y:0,z:0},shininess:30,opacity:100},page:null,uiSetter:[],objectData:null,objComponentsInfo:null,objOffset:null}},computed:{uiSetter(){let e=this.sectionParams,t=[{type:"slider",id:"shininess",value:e.shininess,min:-50,max:50,callback:l.Z.globalUiCallbacks.updateValue(this,"shininess")},{type:"slider",id:"opacity",value:e.opacity,min:0,max:100,callback:l.Z.globalUiCallbacks.updateValue(this,"opacity")},{type:"slider-vector",id:"lightDirection",value:e.lightDirection,min:{x:-100,y:-100,z:-100},max:{x:100,y:100,z:100},callback:l.Z.globalUiCallbacks.updatePoint(this,"lightDirection")},{type:"slider-vector",id:"lightColor",value:e.lightColor,min:{x:0,y:0,z:0},max:{x:255,y:255,z:255},callback:l.Z.globalUiCallbacks.updatePoint(this,"lightColor")},{type:"slider-vector",id:"diffuse",value:e.diffuse,min:{x:0,y:0,z:0},max:{x:255,y:255,z:255},callback:l.Z.globalUiCallbacks.updatePoint(this,"diffuse")},{type:"slider-vector",id:"ambient",value:e.ambient,min:{x:0,y:0,z:0},max:{x:255,y:255,z:255},callback:l.Z.globalUiCallbacks.updatePoint(this,"ambient")},{type:"slider-vector",id:"specular",value:e.specular,min:{x:0,y:0,z:0},max:{x:255,y:255,z:255},callback:l.Z.globalUiCallbacks.updatePoint(this,"specular")}];return t}},mounted(){this.getObjectData()},methods:{Init(){if(this.page=this.$refs.page,this.gl=this.page.getGL(),!this.objectData)return;this.page.addProgram("obj",o,r),this.perspective.aspect=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight,this.$refs.page.set3DViewer(this.perspective,this.camera,this.transform);const e=this.objectData.obj;this.objOffset=this.page.setObjectToSceenCenter(e.geometries),this.objComponentsInfo=e.geometries.map((({material:e,data:t,object:a})=>{const i=a+e;return this.page.addComponent("obj",i),t.texcoord&&t.normal?(t.tangent=s.Z.generateTangents(t.position,t.texcoord),this.page.addBuffer("tangent",t.tangent,i)):this.page.addBuffer("tangent",{value:[1,0,0]},i),t.texcoord||(t.texcoord={value:[0,0]}),t.normal||(t.normal={value:[0,0,1]}),t.color?t.position.length===t.color.length&&(t.color={numComponents:3,data:t.color},this.page.addBuffer("color",t.color,i)):this.page.addBuffer("color",{value:[1,1,1,1]},i),this.page.addBuffer("position",{data:t.position},i),this.page.addBuffer("texcoord",{numComponents:2,data:t.texcoord},i),this.page.addBuffer("normal",{data:t.normal},i),{name:i,component:this.page.getComponents()[i]}}))},Render(){if(!this.objectData)return;const e=this.gl;e.enable(e.DEPTH_TEST),e.enable(e.MULTISAMPLE);let t=HNWUEngine.perspective(this.perspective.fieldOfViewRadians,this.perspective.aspect,this.perspective.zNear,this.perspective.zFar),a=HNWUEngine.lookAt(this.camera.position,this.camera.target,this.camera.up),i=HNWUEngine.inverse(a),n=HNWUEngine.getTransformMatrix(HNWUEngine.yRotation(0),this.transform);n=HNWUEngine.translate3d(n,...this.objOffset),this.objComponentsInfo.forEach((({name:e,component:a,material:o})=>{this.page.useProgram(a.program);const r={u_world:n,u_view:i,u_lightDirection:HNWUEngine.normalize([this.sectionParams.lightDirection.x,this.sectionParams.lightDirection.y,this.sectionParams.lightDirection.z]),u_ambientLight:[7,-3,5],u_projection:t,u_viewWorldPosition:this.camera.position,u_lightColor:[this.sectionParams.lightColor.x/255,this.sectionParams.lightColor.y/255,this.sectionParams.lightColor.z/255],diffuse:[this.sectionParams.diffuse.x/255,this.sectionParams.diffuse.y/255,this.sectionParams.diffuse.z/255],ambient:[this.sectionParams.ambient.x/255,this.sectionParams.ambient.y/255,this.sectionParams.ambient.z/255],specular:[this.sectionParams.specular.x/255,this.sectionParams.specular.y/255,this.sectionParams.specular.z/255],shininess:this.sectionParams.shininess,opacity:this.sectionParams.opacity/100};Object.entries(r).forEach((([t,a])=>{this.page.addUniform(t,a,e)})),this.page.setSetters(e),this.page.drawComponent(e)}))},async getObjectData(){let e="./models/lightModel/LightModel.obj";const t=await fetch(e),a=await t.text(),i=s.Z.objectParse(a),n=new URL(e,window.location.href),o=await Promise.all(i.materialLibs.map((async e=>{const t=new URL(e,n).href,a=await fetch(t);return await a.text()}))),r=s.Z.parseMTL(o.join("\n")),l={defaultWhite:s.Z.create1PixelTexture(this.gl,[255,255,255,255])};for(const c of Object.values(r))Object.entries(c).filter((([e])=>e.endsWith("Map"))).forEach((([e,t])=>{let a=l[t];if(!a){const e=new URL(t,n).href;a=s.Z.createTexture(this.gl,e),l[t]=a}c[e]=a}));this.objectData={obj:i,materials:r},this.$refs.page.Init()}}},m=a(89);const p=(0,m.Z)(u,[["render",n]]);var g=p}}]);
//# sourceMappingURL=362.95866839.js.map