"use strict";(self["webpackChunkrock_sugar"]=self["webpackChunkrock_sugar"]||[]).push([[235],{8235:function(e,t,n){n.r(t),n.d(t,{default:function(){return g}});var a=n(3396);function o(e,t,n,o,r,i){const s=(0,a.up)("webgl_basic_render_panel");return(0,a.wg)(),(0,a.j4)(s,{prop_des_data:r.desData,prop_ui_setter:r.uiSetter,prop_vertex_shader:r.vertexShaderSource,prop_fragment_shader:r.fragmentShaderSource,prop_section_params:r.sectionParams,ref:"page",onInit:i.Init,onRender:i.Render,onProp_ui_setter:r.uiSetter},null,8,["prop_des_data","prop_ui_setter","prop_vertex_shader","prop_fragment_shader","prop_section_params","onInit","onRender","onProp_ui_setter"])}var r="\nattribute vec4 a_position;\nattribute vec3 a_normal;\nattribute vec3 a_tangent;\nattribute vec2 a_texcoord;\nattribute vec4 a_color;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_world;\nuniform vec3 u_viewWorldPosition;\n\nvarying vec3 v_normal;\nvarying vec3 v_tangent;\nvarying vec3 v_surfaceToView;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\n\nvoid main() {\n  vec4 worldPosition = u_world * a_position;\n  gl_Position = u_projection * u_view * worldPosition;\n  v_surfaceToView = u_viewWorldPosition - worldPosition.xyz;\n  mat3 normalMat = mat3(u_world);\n  v_normal = normalize(normalMat * a_normal);\n  v_tangent = normalize(normalMat * a_tangent);\n\n  v_texcoord = a_texcoord;\n  v_color = a_color;\n}\n",i="\nprecision highp float;\n\nvarying vec3 v_normal;\nvarying vec3 v_tangent;\nvarying vec3 v_surfaceToView;\nvarying vec2 v_texcoord;\nvarying vec4 v_color;\n\nuniform vec3 diffuse;\nuniform sampler2D diffuseMap;\nuniform vec3 ambient;\nuniform vec3 emissive;\nuniform vec3 specular;\nuniform sampler2D specularMap;\nuniform float shininess;\nuniform sampler2D normalMap;\nuniform float opacity;\nuniform vec3 u_lightDirection;\nuniform vec3 u_ambientLight;\n\nvoid main () {\n  vec3 normal = normalize(v_normal) * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n  vec3 tangent = normalize(v_tangent) * ( float( gl_FrontFacing ) * 2.0 - 1.0 );\n  vec3 bitangent = normalize(cross(normal, tangent));\n\n  mat3 tbn = mat3(tangent, bitangent, normal);\n  normal = texture2D(normalMap, v_texcoord).rgb * 2. - 1.;\n  normal = normalize(tbn * normal);\n\n  vec3 surfaceToViewDirection = normalize(v_surfaceToView);\n  vec3 halfVector = normalize(u_lightDirection + surfaceToViewDirection);\n\n  float fakeLight = dot(u_lightDirection, normal) * .5 + .5;\n  float specularLight = clamp(dot(normal, halfVector), 0.0, 1.0);\n  vec4 specularMapColor = texture2D(specularMap, v_texcoord);\n  vec3 effectiveSpecular = specular * specularMapColor.rgb;\n\n  vec4 diffuseMapColor = texture2D(diffuseMap, v_texcoord);\n  vec3 effectiveDiffuse =  diffuseMapColor.rgb * v_color.rgb;\n  float effectiveOpacity = opacity * diffuseMapColor.a * v_color.a;\n\n  gl_FragColor = vec4(\n      emissive +\n      ambient * u_ambientLight +\n      effectiveDiffuse * fakeLight +\n      effectiveSpecular * pow(specularLight, shininess),\n      1);\n}\n\n",s=n(311);const c={category:"Webgl",name:"WebglRender",buttonContent:"查看源码",title:"Webgl基础渲染器",content:"WebglRender."};var l={name:"WebglRender",data(){return{gl:null,canvas:null,program:null,vertexShaderSource:r,fragmentShaderSource:i,desData:c,perspective:{aspect:0,fieldOfViewRadians:HNWUEngine.degToRad(60),zNear:1,zFar:1e4},transform:{translation:[0,0,0],rotation:[HNWUEngine.degToRad(0),HNWUEngine.degToRad(0),HNWUEngine.degToRad(0)],scale:[1,1,1]},camera:{target:[0,0,0],position:[0,0,1],up:[0,1,0]},sectionParams:{lightDirection:[-1,3,5]},page:null,uiSetter:[],objectData:null,objComponentsInfo:null,objOffset:null}},computed:{defaultMaterial(){return{diffuse:[1,1,1],diffuseMap:s.Z.create1PixelTexture(this.gl,[255,255,255,0]),normalMap:s.Z.create1PixelTexture(this.gl,[255,255,255,0]),ambient:[0,0,0],specular:[0,0,0],specularMap:s.Z.create1PixelTexture(this.gl,[255,255,255,255]),shininess:400,opacity:1}}},mounted(){this.getObjectData()},methods:{Init(){if(this.page=this.$refs.page,this.gl=this.page.getGL(),!this.objectData)return;this.page.addProgram("obj",r,i),this.perspective.aspect=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight,this.$refs.page.set3DViewer(this.perspective,this.camera,this.transform);const e=this.objectData.obj;this.objOffset=this.page.setObjectToSceenCenter(e.geometries),this.objComponentsInfo=e.geometries.map((({material:e,data:t,object:n})=>{const a=n+e;return this.page.addComponent("obj",a),t.texcoord&&t.normal?(t.tangent=s.Z.generateTangents(t.position,t.texcoord),this.page.addBuffer("tangent",t.tangent,a)):this.page.addBuffer("tangent",{value:[1,0,0]},a),t.texcoord||(t.texcoord={value:[0,0]}),t.normal||(t.normal={value:[0,0,1]}),t.color?t.position.length===t.color.length&&(t.color={numComponents:3,data:t.color},this.page.addBuffer("color",t.color,a)):this.page.addBuffer("color",{value:[1,1,1,1]},a),this.page.addBuffer("position",{data:t.position},a),this.page.addBuffer("texcoord",{numComponents:2,data:t.texcoord},a),this.page.addBuffer("normal",{data:t.normal},a),console.log(this.objectData.materials[e],"material"),{name:a,component:this.page.getComponents()[a],material:{...this.defaultMaterial,...this.objectData.materials[e]}}}))},Render(){if(!this.objectData)return;console.log(this.objectData,"objectData");const e=this.gl;e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE),e.enable(e.MULTISAMPLE);let t=HNWUEngine.perspective(this.perspective.fieldOfViewRadians,this.perspective.aspect,this.perspective.zNear,this.perspective.zFar),n=HNWUEngine.lookAt(this.camera.position,this.camera.target,this.camera.up),a=HNWUEngine.inverse(n),o=HNWUEngine.getTransformMatrix(HNWUEngine.yRotation(0),this.transform);o=HNWUEngine.translate3d(o,...this.objOffset),this.objComponentsInfo.forEach((({name:e,component:n,material:r})=>{this.page.useProgram(n.program);const i={u_world:o,u_view:a,u_lightDirection:HNWUEngine.normalize(this.sectionParams.lightDirection),u_projection:t,u_viewWorldPosition:this.camera.position},s=Object.assign(i,r);Object.entries(s).forEach((([t,n])=>{this.page.addUniform(t,n,e)})),this.page.setSetters(e),this.page.drawComponent(e)}))},async getObjectData(){let e="./models/marci/marci.obj";const t=await fetch(e),n=await t.text(),a=s.Z.objectParse(n),o=new URL(e,window.location.href),r=await Promise.all(a.materialLibs.map((async e=>{const t=new URL(e,o).href,n=await fetch(t);return await n.text()}))),i=s.Z.parseMTL(r.join("\n")),c={defaultWhite:s.Z.create1PixelTexture(this.gl,[255,255,255,255])};for(const l of Object.values(i))Object.entries(l).filter((([e])=>e.endsWith("Map"))).forEach((([e,t])=>{let n=c[t];if(!n){const e=new URL(t,o).href;n=s.Z.createTexture(this.gl,e),c[t]=n}l[e]=n}));this.objectData={obj:a,materials:i},this.$refs.page.Init()}}},p=n(89);const u=(0,p.Z)(l,[["render",o]]);var g=u}}]);
//# sourceMappingURL=235.bf6f4714.js.map