"use strict";(self["webpackChunkrock_sugar"]=self["webpackChunkrock_sugar"]||[]).push([[173],{4173:function(e,t,a){a.r(t),a.d(t,{default:function(){return u}});var n=a(3396);function r(e,t,a,r,o,i){const s=(0,n.up)("nano_webgl_demo_panel");return(0,n.wg)(),(0,n.j4)(s,{prop_des_data:o.desData,prop_ui_setter:o.uiSetter,prop_vertex_shader:o.vertexShaderSource,prop_fragment_shader:o.fragmentShaderSource,prop_section_params:o.sectionParams,ref:"page",onInit:i.Init,onRender:i.Render,onProp_ui_setter:o.uiSetter},null,8,["prop_des_data","prop_ui_setter","prop_vertex_shader","prop_fragment_shader","prop_section_params","onInit","onRender","onProp_ui_setter"])}a(7658);var o="\nattribute vec4 a_position;\nattribute vec3 a_normal;\n\nuniform mat4 u_projection;\nuniform mat4 u_view;\nuniform mat4 u_world;\n\nvarying vec3 v_normal;\n\nvoid main() {\n  gl_Position = u_projection * u_view * u_world * a_position;\n  v_normal = mat3(u_world) * a_normal;\n}\n",i="\nprecision mediump float;\n\nvarying vec3 v_normal;\n\nuniform vec4 u_diffuse;\nuniform vec3 u_lightDirection;\n\nvoid main () {\n  vec3 normal = normalize(v_normal);\n  float fakeLight = dot(u_lightDirection, normal) * .5 + .5;\n  gl_FragColor = vec4(u_diffuse.rgb * fakeLight, u_diffuse.a);\n}\n\n";a(720);const s={category:"Webgl",name:"ObjResolver",buttonContent:"查看源码",title:"模型解析",content:"Model analysis."};var c={name:"ObjResolver",data(){return{gl:null,canvas:null,program:null,vertexShaderSource:o,fragmentShaderSource:i,desData:s,perspective:{aspect:0,fieldOfViewRadians:HNWUEngine.degToRad(60),zNear:1,zFar:1e3},transform:{translation:[0,0,0],rotation:[HNWUEngine.degToRad(0),HNWUEngine.degToRad(0),HNWUEngine.degToRad(0)],scale:[1,1,1]},camera:{target:[0,0,0],position:[0,0,3],up:[0,1,0]},sectionParams:{},page:null,uiSetter:[],objectData:null}},mounted(){this.getObjectData()},methods:{Init(){if(!this.objectData)return;this.page=this.$refs.page,this.gl=this.page.getGL(),this.canvas=this.page.getCanvas(),this.program=this.page.getProgram(),this.perspective.aspect=this.gl.canvas.clientWidth/this.gl.canvas.clientHeight,this.page.setTransform(this.transform);const e=this.objectParse(this.objectData);console.log(e,"data"),e.geometries.map((({data:e})=>{this.page.addBuffer("position",{data:e.position}),this.page.addBuffer("texcoord",{numComponents:2,data:e.texcoord}),this.page.addBuffer("normal",{data:e.normal})}))},Render(){if(!this.objectData)return;const e=this.gl;e.enable(e.DEPTH_TEST),e.enable(e.CULL_FACE);let t=HNWUEngine.perspective(this.perspective.fieldOfViewRadians,this.perspective.aspect,this.perspective.zNear,this.perspective.zFar),a=HNWUEngine.lookAt(this.camera.position,this.camera.target,this.camera.up),n=HNWUEngine.inverse(a),r=HNWUEngine.getTransformMatrix(HNWUEngine.yRotation(0),this.transform);this.page.addUniform("u_view",n),this.page.addUniform("u_lightDirection",HNWUEngine.normalize([-1,3,5])),this.page.addUniform("u_projection",t),this.page.addUniform("u_diffuse",[1,1,1,1]),this.page.addUniform("u_world",r)},async getObjectData(){const e=await fetch("https://webglfundamentals.org/webgl/resources/models/chair/chair.obj"),t=await e.text();this.objectData=t,this.$refs.page.Init()},objectParse(e){const t=[[0,0,0]],a=[[0,0]],n=[[0,0,0]],r=[t,a,n];let o=[[],[],[]];const i=[],s=[];let c,p=["default"],l="default",u="default";const d=()=>{};function g(){c&&c.data.position.length&&(c=void 0)}function h(){if(!c){const e=[],t=[],a=[];o=[e,t,a],c={object:u,groups:p,material:l,data:{position:e,texcoord:t,normal:a}},s.push(c)}}function f(e){const t=e.split("/");t.forEach(((e,t)=>{if(!e)return;const a=parseInt(e),n=a+(a>=0?0:r[t].length);o[t].push(...r[t][n])}))}const m={v(e){t.push(e.map(parseFloat))},vn(e){n.push(e.map(parseFloat))},vt(e){a.push(e.map(parseFloat))},f(e){h();const t=e.length-2;for(let a=0;a<t;++a)f(e[0]),f(e[a+1]),f(e[a+2])},s:d,mtllib(e,t){i.push(t)},usemtl(e,t){l=t,g()},g(e){p=e,g()},o(e,t){u=t,g()}},_=/(\w*)(?: )*(.*)/,v=e.split("\n");for(let b=0;b<v.length;++b){const e=v[b].trim();if(""===e||e.startsWith("#"))continue;const t=_.exec(e);if(!t)continue;const[,a,n]=t,r=e.split(/\s+/).slice(1),o=m[a];o?o(r,n):console.warn("unhandled keyword:",a)}for(const b of s)b.data=Object.fromEntries(Object.entries(b.data).filter((([,e])=>e.length>0)));return{geometries:s,materialLibs:i}}}},p=a(89);const l=(0,p.Z)(c,[["render",r]]);var u=l}}]);
//# sourceMappingURL=173.e3be294c.js.map